name: Production Build Onprem

on:
  workflow_call:
    inputs:
      app-name:
        required: true
        type: string
      package-json-path:
        required: false
        type: string
        default: 'package.json'
      k8s-namespace:
        required: false
        type: string
        default: 'apps'
      resource-type:
        required: false
        type: string
        default: 'deployment'
      release-tag:
        required: false
        type: string
        description: 'Optional: Manually specify a release tag. If not provided, it will be determined automatically.'

jobs:
  build-onprem:
    uses: ./.github/workflows/shared-build-onprem.yaml
    with:
      app-name: ${{ inputs.app-name }}
      package-json-path: ${{ inputs.package-json-path }}
      k8s-namespace: ${{ inputs.k8s-namespace }}
      resource-type: ${{ inputs.resource-type }}
      release-tag: ${{ inputs.release-tag }}
      environment: 'production'
      harbor-username-secret: 'PROD_HARBOR_REGISTRY_RW_USERNAME'
      harbor-password-secret: 'PROD_HARBOR_REGISTRY_RW_PASSWORD'
    secrets:
      COSIGN_PRIVATE_KEY: ${{ secrets.COSIGN_PRIVATE_KEY }}
      COSIGN_PASSWORD: ${{ secrets.COSIGN_PASSWORD }} 